schema: '2.0'
stages:
  metadata:
    cmd: python -m src.utils.metadata
    deps:
    - path: cafa5/train/go-basic.obo
      hash: md5
      md5: 1208619d97a7bba65757c7c1fa4738d1
      size: 30992530
    - path: cafa5/train/train_sequences.fasta
      hash: md5
      md5: 015f50481d9f22985c5fcfbc004de281
      size: 97263064
    - path: cafa5/train/train_taxonomy.tsv
      hash: md5
      md5: 73f5275813307540e56e1594a7dd26aa
      size: 1835615
    - path: cafa5/train/train_terms.tsv
      hash: md5
      md5: cb6b8fed714290bae3d661b018ce3a58
      size: 119091574
    - path: src/utils/annotation.py
      hash: md5
      md5: 761014dfb32fb459a9e4aef1f1c60d39
      size: 10513
    - path: src/utils/metadata.py
      hash: md5
      md5: 5332810e4608ece1bcdf5548194e8907
      size: 7751
    params:
      params.yaml:
        metadata.cluster_folder: clusters
        metadata.data_folder: cafa5/train
        metadata.out: output
        metadata.translated_with_aspect: true
    outs:
    - path: output/go_sentences.tsv
      hash: md5
      md5: 3961a1c6838ea630bc7c4c7a9f095f9e
      size: 4249705
    - path: output/metadata.tsv
      hash: md5
      md5: b2002dc87b050dc6b1853e8a2718735a
      size: 28516114
  embed_seq:
    cmd: python -m src.data.embed_seq
    deps:
    - path: cafa5/test/testsuperset.fasta
      hash: md5
      md5: 0f55645b1203fe26fc741b1579018687
      size: 72173431
    - path: cafa5/train/train_sequences.fasta
      hash: md5
      md5: 015f50481d9f22985c5fcfbc004de281
      size: 97263064
    params:
      params.yaml:
        embed_seq.device: cuda
        embed_seq.emb_type: per_prot
        embed_seq.max_seq_len: 2048
        embed_seq.model: Rostlab/prot_t5_xl_half_uniref50-enc
        embed_seq.uniprot: embeddings/per-protein.h5
    outs:
    - path: embeddings/sequence_embeddings.h5
      hash: md5
      md5: ef6752745faabed7abfcf7b1cd782741
      size: 507485840
  embed_text:
    cmd: python -m src.data.embed_text
    deps:
    - path: output/go_sentences.tsv
      hash: md5
      md5: 3961a1c6838ea630bc7c4c7a9f095f9e
      size: 4249705
    - path: src/data/embed_text.py
      hash: md5
      md5: 7856b2056b2b81c8fa2f0afe76afad54
      size: 2914
    params:
      params.yaml:
        embed_text.device: cuda
        embed_text.max_len: 1024
        embed_text.model: microsoft/Phi-3.5-mini-instruct
        embed_text.sentence_level: sentence_embeddings
        embed_text.tokenizer: microsoft/Phi-3.5-mini-instruct
    outs:
    - path: embeddings/text_embeddings.h5
      hash: md5
      md5: 5bd78b218a58007328d4c314bc94ed3f
      size: 548181520
  embed_vis:
    cmd: python -m src.eval.embed_vis
    deps:
    - path: src/eval/embed_vis.py
      hash: md5
      md5: 17d00cf81814f53b8fa5520515001c74
      size: 6078
    params:
      params.yaml:
        embed_vis.legend: Kingdom
        embed_vis.metadata: output/train_metadata.tsv
        embed_vis.metric: cosine
        embed_vis.min_dist: 0.1
        embed_vis.n_components: 2
        embed_vis.n_neighbors: 15
        embed_vis.seed: 42
        embed_vis.sequence_embeddings: embeddings/sequence_embeddings.h5
        embed_vis.subsample: 1000
        embed_vis.text_embeddings: embeddings/text_embeddings.h5
  cluster:
    cmd: python -m src.utils.cluster
    deps:
    - path: cafa5/test/testsuperset.fasta
      hash: md5
      md5: 0f55645b1203fe26fc741b1579018687
      size: 72173431
    - path: cafa5/train/train_sequences.fasta
      hash: md5
      md5: 015f50481d9f22985c5fcfbc004de281
      size: 97263064
    params:
      params.yaml:
        cluster.out: clusters
        cluster.test:
          sequence: cafa5/test/testsuperset.fasta
          threads: 12
          max_seq_len: 2048
          coverage: 0.8
          min_seq_id: 0.3
          cluster_mode: 0
          cov_mode: 0
          reassign: true
        cluster.train:
          sequence: cafa5/train/train_sequences.fasta
          threads: 12
          max_seq_len: 2048
          coverage: 0.8
          min_seq_id: 0.3
          cluster_mode: 0
          cov_mode: 0
          reassign: true
    outs:
    - path: clusters
      hash: md5
      md5: e6a5bf137d834bcd41819ca9479b6232.dir
      size: 189450718
      nfiles: 6
